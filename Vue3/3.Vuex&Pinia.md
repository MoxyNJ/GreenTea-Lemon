- Vuex：https://vuex.vuejs.org/zh/index.html
- Pinia：https://pinia.vuejs.org/zh/

## Vuex 状态管理

## 1 核心概念

- State：数据即状态，数据变化管理即状态管理。
- Getters：类似组件的computed。组件在获取state前，store会进行拦截并进行适当修改后再返回。
  - 也可返回一个回调函数，组件可调用该Getters，并传入参数。该回调函数可根据入参返回需要的值。
- Mutations：修改 State 的唯一方式是提交 Mutations。
- Actions
- Modules：模块化



状态管理：在开发中，应用需要处理各种各样的数据，这些数据需要保存在我们应用程序中的某个位置集中管理。

- 状态：数据当前的具体值，就是一个“状态”；数据是不断变化的，也就是说状态是不断变化的。

状态管理的核心概念：

- State 状态：在 Vue 中，data 或 setup 中定义和使用的数据，就是状态。
- View 视图：在模版 template 中使用数据，模块最终渲染成 DOM，称之为视图。
- Action 行为：在页面中用户交互等因素会触发事件，事件推动状态变化，称之为行为。
- Store：仓库，即状态树。Vuex 规定单一数据源（Single Source of Truth），即一个项目中只可创建一个Store（Pinia不限制）。



Vuex 状态管理流程图：

![image-20230506093222855](images/3.Vuex&Pinia.assets/image-20230506093222855.png)



常见的目录结构：

```js
--src
 |--store  // vuex 根目录
   |--index.js  // 创建并导出 store
   |--modules
      |--counter.js
      |--home.js

```

流程：

```js
//【1】store/index.js 定义 Store 并导出
import { createStore } from 'vue';
const store = createStore({
  state: () => ({
    counter: 100,    // 定义state数据
    friends: ['ninjee', 'moxy', 'hou']
  }),
  mutations: {
    imcrement(state) { state.counter++ }  // 定义修改数据的逻辑
  },
  getters: {
    doubleCounter(state, getters) {
      // getters.xxx 可以调用getters中其他函数并获取返回值
      return state.counter * 2;     // 使用：$store.getters.doubleCounter
    },
    findFriendByIndex(state) {
      // 可以返回一个函数，组件可调用并传入参数，找到需要的值
      return (index) => state.friends[index];
    }
  }
})
export default store


//【2】在main.js通过插件形式安装store
crateApp(App).use(store).mount('#app')

//【3】在模版中使用：$store.state
<template>
  <h2>当前计数：{{ $store.state.counter }}</h2>
</template>


//【4】修改vuex的数据：useStore()；
//【5】在代码中使用：需通过toRefs添加依赖，使解构的state不丢失响应式
import { toRefs } from 'vue';
import { useStore } from 'vuex';
const store = useStore();

// 使用state
const counter = toRefs(store.state);
console.log(counter);

// 修改state：定义触发事件的回调函数，修改counter
function increment() {
  store.commit("increment");    // 调用store中mutations定义的修改逻辑
}

//【6】快速解构和使用，template无需再通过$store.state.xxx调用
<template>
  <h2>当前计数：{{ counter }}</h2>
	<h2>名称：{{ name }}</h2>
</template>

const store = useStore();
const {counter, level} = toRefs(store.state);
```

额外补充：

- 在 Options API 中，可通过在 `computed`中，通过 `mapstate()` 建立store 中数据和template的映射关系，算是一个语法糖。

  ```js
  ```

  



