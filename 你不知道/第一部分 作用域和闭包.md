# 1 作用域是什么

## 1.1 编译原理

提前编译：C语言是提前编译的，需要把原始文件.c 的文件编译为 .s .exe 等可以直接执行的格式，然后会执行。

### 编译流程

#### 编译类语言的编译流程（Java、C）：

- 分词 + 词法分析（Tokenizing/Lexing）
  - 划分词法单元（token）。把代码分解成一个个代码块，每个代码都是一个 token。
- 解析 + 语法分析（Parsing）
  - 转换抽象语法树（Abstract Syntax Tree，AST）。一个逐级嵌套的程序语法结构树。
- 代码生成（create）
  - 生成可执行的代码。

#### 解释型语言的编译流程（JavaScript、Python）：

不需要对代码进行提前编译，生成可执行文件，然后执行这个文件。而是把编译和执行压缩为一个流程，通常在执行代码前的微秒级内编译完毕。编译后立即执行。



可以这样理解：

编译型语言，没有引擎这个中枢控制，而是直接划分为两个阶段：编译、执行。

解释型语言，有一个总控制”引擎“。代码的执行被划分为：编译时、运行时，这两个阶段。在执行代码时前后进行。



## 1.2 解释型的执行流程：

#### 模块

引擎：控制整个JavaScript 程序的编译、执行过程。神经中枢。

编译器：管理编译部分的工作。划分 token、转换 AST、生成可执行代码。

作用域：维护一系列查询。包括对所有已经声明的变量（标识符）的可访问权限。



以 `var a = 2;` 为例，全部流程由引擎控制：

1. 编译时，编译器完成以下操作：
   1. 划分词法单元（Token）。
   2. 解析为语法结构树（AST）。
   3. 代码生成，此处区别于编译型语言：
      1. 编译器向引擎询问：作用域中是否已经有一个相同的变量名称。
         1. 如果有，则编译器忽略该声明，只执行编译工作（编译赋值操作）；
         2. 如果没有，则编译器会通过引擎，通知作用域在当前作用域下，进行一个变量声明，然后执行编译工作（赋值操作）；
         3. 引擎在收到编译器的问询后，会对作用域进行问询，然后编译器和作用域之间反馈结果。
      2. 编译器生成运行时所执行的代码，是一个赋值操作。
2. 运行时，引擎完成以下操作：
   1. 引擎运行到此处代码，会询问作用域，当前作用域集合是否存在该变量（a）。
      1. 如果有，则引擎会使用这个变量，完成后面的操作；
      2. 如果没有，则引擎会询问上级作用域，是否存在这个变量，以此类推；
      3. 最终如果依然没有找到，则抛出异常

#### 简短的总结：

- 编译时：编译器会让作用域在当前作用域中，声明一个变量。
- 运行时：引擎会查询作用域，是否存在该变量。



### 作用域

#### 1. 函数作用域

#### 2. 块作用域

































#### 